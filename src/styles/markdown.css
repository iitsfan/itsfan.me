.markdown {
    @apply text-sm sm:text-base break-words font-medium text-(--text-secondary);

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        @apply my-5 font-bold relative scroll-mt-14 sm:scroll-mt-22 text-(--text-primary) tracking-wide leading-tight;

        a.anchor {
            @apply relative block w-full cursor-pointer text-inherit no-underline;

            &::after {
                @apply absolute top-0 bottom-0 w-6 -left-4 content-[''];
            }

            &::before {
                @apply absolute font-bold opacity-0 transition-opacity duration-300 cursor-pointer -left-4 text-(--text-tertiary) content-['#'];
            }

            &:hover {
                @apply text-inherit no-underline;
            }
        }

        &:hover a.anchor::before {
            @apply opacity-50;
        }
    }

    h1,
    h2 {
        @apply text-xl sm:text-2xl;
    }

    h3,
    h4 {
        @apply text-lg sm:text-xl;
    }

    hr {
        @apply my-6 mt-10 border-0 h-[1px] bg-(--border-subtle);
    }

    p,
    li {
        @apply my-4;
    }

    ul:not(.contains-task-list) {
        @apply my-4 pl-6 space-y-3;

        li:not(.task-list-item) {
            @apply relative;

            &::before {
                @apply absolute -left-4 top-0 text-(--text-tertiary) content-['•'];
            }
        }

        ul:not(.contains-task-list) {
            @apply my-2 pl-4;

            li:not(.task-list-item)::before {
                @apply content-['◦'];
            }

            ul li:not(.task-list-item)::before {
                @apply content-['▪'];
            }
        }
    }

    .task-list-item {
        @apply list-none;

        input[type="checkbox"] {
            @apply mr-2;
        }
    }

    ol {
        @apply my-4 pl-6 space-y-3 list-decimal;

        li {
            @apply relative;
        }

        ol {
            @apply my-2 pl-4 list-decimal;
        }
    }

    :not(h1, h2, h3, h4, h5, h6, ul, sup)>a {
        @apply text-(--accent) transition cursor-pointer duration-300 underline underline-offset-4 decoration-solid decoration-(--accent-soft) hover:text-(--accent-strong) hover:decoration-(--accent-strong);
    }

    :not(pre)>code {
        @apply inline-flex items-center bg-(--surface-muted) mx-1 px-2 py-0.5 rounded whitespace-pre transition-colors duration-300 text-sm font-medium text-(--text-secondary) border border-(--border-subtle);

        a {
            @apply no-underline;
        }
    }

    kbd {
        @apply inline-flex items-center bg-(--surface-muted) border border-(--border-subtle) mx-1 px-2 py-0.5 rounded text-xs font-mono font-semibold text-(--text-primary) transition-colors duration-300;
    }

    pre {
        @apply bg-(--surface-muted) border border-(--border-subtle) rounded-lg overflow-auto my-5 p-4 text-(--text-secondary) shadow-sm;

        &::-webkit-scrollbar-track,
        &::-webkit-scrollbar-corner {
            @apply rounded-full bg-(--border-subtle);
        }

        &::-webkit-scrollbar-thumb {
            @apply rounded-full bg-(--accent);
        }
    }

    blockquote {
        @apply relative my-6 rounded-md border border-(--border-subtle) border-l-4 border-l-(--accent) bg-(--surface-card) px-4 text-(--text-secondary) shadow-sm;
    }

    img,
    video {
        @apply mt-8 block rounded;
    }

    table {
        @apply w-full my-6 border border-(--border-subtle) rounded-lg overflow-hidden bg-(--surface-card) border-collapse shadow-sm;
    }

    thead {
        @apply bg-(--surface-muted) text-(--text-primary) uppercase text-sm tracking-wider;
    }

    th,
    td {
        @apply px-4 py-3 border-b border-(--border-subtle) text-left align-top text-sm;
    }

    th {
        @apply font-semibold;
    }

    tbody tr:nth-child(even) {
        @apply bg-(--surface-muted)/30;
    }

    tbody tr:hover {
        @apply transition-colors duration-200 bg-(--surface-overlay)/40;
    }

    tbody tr:last-of-type td {
        @apply border-b-0;
    }

    figure[data-rehype-pretty-code-figure] {
        @apply my-6 relative;

        [data-rehype-pretty-code-title] {
            @apply px-4 py-2 text-sm font-semibold text-(--text-primary) bg-(--surface-card) border border-(--border-subtle) rounded-t-lg border-b-0 m-0 shadow-sm;
        }

        &:has([data-rehype-pretty-code-title]) pre {
            @apply rounded-t-none border-t-0 mt-0;
        }

        pre {
            @apply rounded-lg overflow-x-auto m-0 px-0;
        }

        code {
            @apply text-sm font-mono grid;

            span[data-line] {
                @apply px-4 py-0.5 border-l-2 border-l-transparent;

                &.highlighted {
                    @apply bg-(--accent-soft) border-l-(--accent-strong) border-l-2;
                }

                &.diff.add {
                    @apply bg-green-50/50 border-l-green-500/40 dark:bg-green-900/20 border-l-2;

                    &::before {
                        @apply text-green-600 dark:text-green-400 content-['+'];
                    }
                }

                &.diff.remove {
                    @apply bg-red-50/50 border-l-red-500/40 dark:bg-red-900/20 border-l-2;

                    &::before {
                        @apply text-red-600 dark:text-red-400 content-['-'];
                    }
                }
            }
        }

        button {
            @apply hover:opacity-100! absolute right-3 top-3 flex cursor-pointer select-none items-center justify-center rounded-md bg-(--surface-muted)/90 text-sm font-medium text-(--text-tertiary) opacity-0 shadow outline-0 transition border border-(--border-subtle);
        
            svg {
                @apply m-2 size-5;
            }
        
            .check {
                @apply opacity-0 transition-opacity;
            }
        
            &.copied {
                @apply opacity-100! text-(--accent-strong);
        
                .check {
                    @apply opacity-100;
                }
            }
        }

        &:hover {
            button {
                @apply opacity-80;
            }
        }

        &:has([data-rehype-pretty-code-title]) button {
            @apply top-12;
        }
    }


    code span {
        @apply text-(--shiki-light);
    }
}

[data-theme='dark'] .markdown code span {
    @apply text-(--shiki-dark);
}
